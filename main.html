function populateVoices() {
  voices = speechSynthesis.getVoices();
  voicesDropdown.innerHTML = '<option value="">Select A Voice</option>';

  if (voices.length === 0) {
    voicesDropdown.innerHTML = '<option value="">No voices available</option>';
    speakButton.disabled = true;
    return;
  } else {
    speakButton.disabled = false;
  }

  voices.forEach((voice, i) => {
    const option = document.createElement('option');
    option.value = i;
    option.textContent = `${voice.name} (${voice.lang})${voice.default ? ' â€” DEFAULT' : ''}`;
    voicesDropdown.appendChild(option);
  });
}

function speak() {
  if (speechSynthesis.speaking) {
    speechSynthesis.cancel();
  }

  if (!textArea.value.trim()) {
    alert('Please enter text to speak.');
    return;
  }

  msg.text = textArea.value;
  msg.rate = rate.value;
  msg.pitch = pitch.value;

  if (voicesDropdown.value) {
    msg.voice = voices[Number(voicesDropdown.value)];
  } else {
    msg.voice = null;
  }

  speechSynthesis.speak(msg);
}
